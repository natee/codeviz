# 卷王排行功能说明

## 🏆 功能概述

卷王排行是 codeviz 的核心功能之一，它可以分析 Git 仓库中每个贡献者的提交行为，计算他们的 996 指数，并生成可视化的排行榜。

### 核心价值

- **团队洞察**：了解团队成员的工作强度分布
- **文化识别**：识别团队中的"卷王"和加班文化
- **个人定位**：了解自己在团队中的位置
- **数据驱动**：用数据说话，避免主观判断

## 📊 算法原理

### 996 指数计算

```typescript
// 核心公式
const overtimeRatio = ((workHours + weekendCommits * 0.8) / totalCommits) * 100
const index996 = overtimeRatio * 3
```

**计算维度**：
1. **工作时间提交**：9:00-18:00 的提交
2. **加班时间提交**：工作日 18:00 后或 9:00 前的提交
3. **周末提交**：周六、周日的提交（权重 0.8）
4. **总提交数**：所有有效提交

**指数解读**：
- 0-30: 🟢 健康（正常工作节奏）
- 30-60: 🟡 中度（有一定加班）
- 60-80: 🔴 严重（频繁加班）
- 80+: 🔴 极端（996 文化）

### 数据收集流程

```
1. Git Log 解析
   ↓
2. 按作者分组统计
   ↓
3. 时间分布分析
   ↓
4. 工作/加班/周末分类
   ↓
5. 996 指数计算
   ↓
6. 排序与排名
   ↓
7. 生成排行榜
```

## 🎯 使用场景

### 场景 1：入职新团队

```bash
# 快速了解团队工作文化
codeviz ranking --topN 10
```

**分析要点**：
- 查看前三名的 996 指数
- 观察平均指数是否超过 30
- 检查周末提交占比

### 场景 2：团队健康度评估

```bash
# 分析最近一年数据
codeviz ranking -y 2025 --min-commits 20
```

**分析要点**：
- 中位数 vs 平均数（判断是否有极端个例）
- 团队整体分布情况
- 趋势变化（对比往年）

### 场景 3：个人定位

```bash
# 查看自己在团队中的位置
codeviz ranking --self --author "你的名字"
```

**分析要点**：
- 自己的排名和指数
- 与团队平均值的对比
- 是否需要调整工作节奏

### 场景 4：排除干扰数据

```bash
# 排除机器人和自动化提交
codeviz ranking --exclude-authors bot,CI,jenkins,github-actions
```

**分析要点**：
- 获得更真实的团队数据
- 避免机器人拉高加班指数

## 🔧 高级功能

### 作者合并

同一个人可能使用不同邮箱提交代码：

```bash
codeviz ranking --merge-authors
```

**工作原理**：
- 识别相同作者名
- 合并不同邮箱的提交
- 统一计算 996 指数

### 时区过滤

跨时区团队需要指定时区：

```bash
# 只分析中国时区的提交
codeviz ranking --timezone "+0800"

# 只分析美国西海岸的提交
codeviz ranking --timezone "-0700"
```

### 自定义工作时间

不同公司工作时间不同：

```bash
# 互联网公司 996
codeviz ranking --hours 9-21

# 外企 955
codeviz ranking --hours 9-18

# 弹性工作制
codeviz ranking --hours 9.5-18.5
```

### 特定作者分析

```bash
# 分析特定作者的详细信息
codeviz ranking --author "张三" --topN 1
```

**输出包含**：
- 详细的时间分布
- 工作日 vs 周末
- 加班率和周末提交比

## 📈 输出解读

### 排行表格

```
┌────────┬────────┬──────────┬────────┬────────┬────────┬────────┐
│排名    │作者    │邮箱      │提交数  │996指数 │加班率  │周末提交│
├────────┼────────┼──────────┼────────┼────────┼────────┼────────┤
│🥇 1    │张三    │...       │523     │78.5    │45.2%   │18.3%   │
│🥈 2    │李四    │...       │342     │65.3    │38.1%   │12.5%   │
│🥉 3    │王五    │...       │287     │52.1    │28.4%   │8.2%    │
└────────┴────────┴──────────┴────────┴────────┴────────┴────────┘
```

**各列含义**：
- **排名**：按 996 指数降序排列
- **作者**：作者名 + 强度徽章（🟢🟡🔴）
- **邮箱**：作者邮箱（灰色显示）
- **提交数**：总提交数量
- **996 指数**：核心指标
- **加班率**：加班提交占比
- **周末提交**：周末提交占比

### 统计摘要

```
📊 统计摘要
  总分析人数: 15
  平均996指数: 45.2
  中位数996指数: 42.1
  最高996指数: 78.5 (张三)
  最低996指数: 12.3 (李四)
  
🥇 卷王之王:
  张三 (zhangsan@company.com)
  996指数: 78.5
```

**分析要点**：
- **平均数 vs 中位数**：判断是否有极端个例
- **最高/最低**：了解团队的两极分化程度
- **卷王之王**：识别最"卷"的成员

## ⚠️ 注意事项

### 数据准确性

1. **提交不代表全部工作**
   - 开会、文档、调试等活动不体现在提交中
   - 结果仅供参考，不能完全代表工作强度

2. **提交习惯影响**
   - 有些人习惯批量提交
   - 有些人习惯频繁小提交
   - 这会影响加班率的计算

3. **数据量要求**
   - 提交数过少（<5）的作者会被过滤
   - 建议分析至少有 20+ 提交的作者

### 隐私保护

- 所有分析在本地进行
- 不会上传任何数据
- 请尊重团队成员隐私

### 使用建议

1. **用于团队健康度评估**，而非个人评判
2. **结合实际情况**，不要仅看数据
3. **定期分析**，观察趋势变化
4. **与团队沟通**，共同改善工作文化

## 🔍 故障排查

### 问题：排行为空

**原因**：
- 仓库提交数过少
- 过滤阈值过高
- 时间范围太短

**解决**：
```bash
# 降低阈值
codeviz ranking --min-commits 1

# 扩大时间范围
codeviz ranking --all-time
```

### 问题：作者过多

**原因**：
- 包含了机器人账号
- 未合并同名作者

**解决**：
```bash
# 排除机器人
codeviz ranking --exclude-authors bot,CI

# 合并作者
codeviz ranking --merge-authors
```

### 问题：指数异常高

**原因**：
- 主要在周末提交
- 工作时间设置不准确

**解决**：
```bash
# 检查工作时间
codeviz ranking --hours 9-18

# 查看详细分布
codeviz ranking --author "异常作者"
```

**最后更新**: 2025-12-17
**版本**: 1.0.0
**维护者**: CodeViz 开发团队